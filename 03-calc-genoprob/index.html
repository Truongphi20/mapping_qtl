<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="last-modified" content="2025-11-22 10:15:12 +0000">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- meta "search-domain" used for google site search function google_search() -->
    <meta name="search-domain" value="">
    <link rel="stylesheet" type="text/css" href="../assets/css/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/bootstrap-theme.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/lesson.css" />
    
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
	<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
	<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	<![endif]-->
    <title>Quantitative Trait Mapping: Calculating Genotype Probabilities</title>
  </head>
  <body>
    <div class="container">
      
<nav class="navbar navbar-default">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      
      

      
      <a class="navbar-brand" href="../">Home</a>

    </div>
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">

	
        <li><a href="../conduct/">Code of Conduct</a></li>

	
        
        <li><a href="../setup/">Setup</a></li>
        <li class="dropdown">
          <a href="../" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Episodes <span class="caret"></span></a>
          <ul class="dropdown-menu">
            
            <li><a href="../02-input-file-format/">Input File Format</a></li>
            
            <li><a href="../03-calc-genoprob/">Calculating Genotype Probabilities</a></li>
            
            <li><a href="../04-special-x-covar/">Special covariates for the X chromosome</a></li>
            
            <li><a href="../05-perform-genome-scan/">Performing a genome scan</a></li>
            
            <li><a href="../06-perform-perm-test/">Performing a permutation test</a></li>
            
            <li><a href="../07-find-lod-peaks/">Finding LOD peaks</a></li>
            
            <li><a href="../08-calc-kinship/">Calculating A Kinship Matrix</a></li>
            
            <li><a href="../09-perform-genome-scan-lmm/">Performing a genome scan with a linear mixed model</a></li>
            
            <li><a href="../10-perform-genome-scan-bin/">Performing a genome scan with binary traits</a></li>
            
            <li><a href="../11-est-qtl-effects/">Estimated QTL effects</a></li>
            
            <li><a href="../12-snp-assoc/">SNP association mapping</a></li>
            
            <li><a href="../13-qtl-in-do/">QTL analysis in Diversity Outbred Mice</a></li>
            
	    <li role="separator" class="divider"></li>
            <li><a href="../aio/">All in one page (Beta)</a></li>
          </ul>
        </li>
	

	
	
        <li class="dropdown">
          <a href="../" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Extras <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="../reference/">Reference</a></li>
            
            <li><a href="../about/">About</a></li>
            
            <li><a href="../discuss/">Discussion</a></li>
            
            <li><a href="../figures/">Figures</a></li>
            
            <li><a href="../guide/">Instructor Notes</a></li>
            
          </ul>
        </li>
	

	
        <li><a href="../license/">License</a></li>
	
	
	<li><a href="/edit/gh-pages/_episodes_rmd/03-calc-genoprob.Rmd">Improve this page <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span></a></li>
	
	
      </ul>
      <form class="navbar-form navbar-right" role="search" id="search" onsubmit="google_search(); return false;">
        <div class="form-group">
          <input type="text" id="google-search" placeholder="Search..." aria-label="Google site search">
        </div>
      </form>
    </div>
  </div>
</nav>


<div class="row">
  <div class="col-md-1">
    <h3>
      
      <a href="../02-input-file-format/"><span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span><span class="sr-only">previous episode</span></a>
      
    </h3>
  </div>
  <div class="col-md-10">
    
    <h3 class="maintitle"><a href="../">Quantitative Trait Mapping</a></h3>
    
  </div>
  <div class="col-md-1">
    <h3>
      
      <a href="../04-special-x-covar/"><span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span><span class="sr-only">next episode</span></a>
      
    </h3>
  </div>
</div>

<article>
<div class="row">
  <div class="col-md-1">
  </div>
  <div class="col-md-10">
    <h1 class="maintitle">Calculating Genotype Probabilities</h1>
  </div>
  <div class="col-md-1">
  </div>
</div>


<blockquote class="objectives">
  <h2>Overview</h2>

  <div class="row">
    <div class="col-md-3">
      <strong>Teaching:</strong> 30 min
      <br/>
      <strong>Exercises:</strong> 30 min
    </div>
    <div class="col-md-9">
      <strong>Questions</strong>
      <ul>
	
	<li><p>How do I calculate QTL at positions between genotyped markers?</p>
</li>
	
	<li><p>How do I calculate QTL genotype probabilities?</p>
</li>
	
	<li><p>How do I calculate allele probabilities?</p>
</li>
	
	<li><p>How can I speed up calculations if I have a large data set?</p>
</li>
	
      </ul>
    </div>
  </div>

  <div class="row">
    <div class="col-md-3">
    </div>
    <div class="col-md-9">
      <strong>Objectives</strong>
      <ul>
	
	<li><p>To explain why the first step in QTL analysis is to calculate genotype probabilities.</p>
</li>
	
	<li><p>To insert pseudomarkers between genotyped markers.</p>
</li>
	
	<li><p>To calculate genotype probabilities.</p>
</li>
	
      </ul>
    </div>
  </div>

</blockquote>

<p>The first task in QTL analysis is to calculate conditional genotype probabilities, given the observed marker data, at each putative QTL position. For example, the first step would be to determine the probabilities for genotypes SS and SB at the locus indicated below.</p>

<p><img src="../fig/unknown_genotype.png" alt="adapted from Broman &amp; Sen, 2009" /></p>

<p>The <code class="language-plaintext highlighter-rouge">calc_genoprob()</code> function calculates QTL genotype probabilities, conditional on the available marker data. These are needed for most of the QTL mapping functions. The result is returned as a list of three-dimensional arrays (one per chromosome). Each 3d array of probabilities is arranged as individuals × genotypes × positions.</p>

<p><img src="../fig/threeD_array.png" alt="" /></p>

<p><a href="http://venus.ifca.unican.es/Rintro/_images/dataStructuresNew.png">See this page for a graphical review of data structures in R</a>.</p>

<p>To find QTL at positions between markers (so called “pseudomarkers”), first  insert pseudomarkers into the genetic map with the function <code class="language-plaintext highlighter-rouge">insert_pseudomarkers()</code>.</p>

<p>We’ll use the
<a href="https://github.com/kbroman/qtl2/tree/gh-pages/assets/sampledata/iron">iron dataset</a>
from <a href="https://www.ncbi.nlm.nih.gov/pubmed/16799992">Grant et al. (2006) Hepatology 44:174-185</a>
(an intercross) as an example. In this study spleen and liver iron levels were measured in an F2 cross between mouse strains C57BL/6J and SWR. C57BL/6J mice exhibit low levels of non-heme iron, while SWR mice exhibit high levels. Iron levels between spleen and liver in the F2s were poorly correlated, indicating tissue-specific regulation. Significant QTL were found on chromosomes 2 and 16 for liver, and on chromosomes 8 and 9 in spleen. Candidate genes included transferrin near the chromosome 9 peak, and <i>β</i>2-microglobulin near the chromosome 2 peak.</p>

<p>We first load the data using the function <code class="language-plaintext highlighter-rouge">system.file</code>, which finds files located in packages. The iron data are built into the qtl2 package, so we can use the <code class="language-plaintext highlighter-rouge">system.file()</code> function to load them directly from the package.</p>

<div class="language-plaintext r highlighter-rouge"><div class="highlight"><pre class="highlight"><code>library(qtl2)
iron &lt;- read_cross2(file = system.file("extdata", "iron.zip", package="qtl2") )
</code></pre></div></div>

<p>To load your own data from your machine, you would use the file path to your data files. For example, if the file path to your data files is <code class="language-plaintext highlighter-rouge">/Users/myUserName/qtlProject/data</code>, the command to load your data would look like this:</p>

<div class="language-plaintext r highlighter-rouge"><div class="highlight"><pre class="highlight"><code>myQTLdata &lt;- read_cross2(file = "/Users/myUserName/qtlProject/data/myqtldata.yaml" )
</code></pre></div></div>

<p>The YAML file contains all control information for your data, including names of data files, cross type, column specifications for sex and cross information, and more. This can also be in JSON format. Alternatively, all data files can be zipped together for loading.</p>

<div class="language-plaintext r highlighter-rouge"><div class="highlight"><pre class="highlight"><code>myQTLdata &lt;- read_cross2(file = "/Users/myUserName/qtlProject/data/myqtldata.zip" )
</code></pre></div></div>

<p>Back to the iron data. Now look at a summary of the cross data and the names of each variable within the data.</p>

<div class="language-plaintext r highlighter-rouge"><div class="highlight"><pre class="highlight"><code>summary(iron)
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Object of class cross2 (crosstype "f2")

Total individuals            284
No. genotyped individuals    284
No. phenotyped individuals   284
No. with both geno &amp; pheno   284

No. phenotypes                 2
No. covariates                 2
No. phenotype covariates       1

No. chromosomes               20
Total markers                 66

No. markers by chr:
 1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19  X 
 3  5  2  2  2  2  7  8  5  2  7  2  2  2  2  5  2  2  2  2 
</code></pre></div></div>

<div class="language-plaintext r highlighter-rouge"><div class="highlight"><pre class="highlight"><code>names(iron)
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code> [1] "crosstype"  "geno"       "gmap"       "pmap"       "pheno"     
 [6] "covar"      "phenocovar" "is_x_chr"   "is_female"  "cross_info"
[11] "alleles"   
</code></pre></div></div>

<p>Have a look at the markers listed in the genetic map, <code class="language-plaintext highlighter-rouge">gmap</code>. Markers are listed by chromosome and described by cM position. View only the markers on the first several chromosomes.</p>

<div class="language-plaintext r highlighter-rouge"><div class="highlight"><pre class="highlight"><code>head(iron$gmap)
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$`1`
D1Mit18 D1Mit80 D1Mit17 
   27.3    51.4   110.4 

$`2`
D2Mit379  D2Mit75  D2Mit17 D2Mit304  D2Mit48 
    38.3     48.1     56.8     58.0     73.2 

$`3`
D3Mit22 D3Mit18 
   25.1    54.6 

$`4`
  D4Mit2 D4Mit352 
    10.9     53.6 

$`5`
D5Mit11 D5Mit30 
   17.5    62.3 

$`6`
D6Mit104  D6Mit15 
    41.5     66.7 
</code></pre></div></div>

<p>We then use <code class="language-plaintext highlighter-rouge">insert_pseudomarkers()</code> to insert pseudomarkers into the
genetic map, which we grab from the <code class="language-plaintext highlighter-rouge">iron</code> object as <code class="language-plaintext highlighter-rouge">iron$gmap</code>:</p>

<div class="language-plaintext r highlighter-rouge"><div class="highlight"><pre class="highlight"><code>map &lt;- insert_pseudomarkers(map=iron$gmap, step=1)
</code></pre></div></div>

<p>Pseudomarkers are inserted at regular intervals, and genotype probabilities will be calculated at each of these intervals. Now have a look at the new object called <code class="language-plaintext highlighter-rouge">map</code>. View only the first two chromosomes.</p>

<div class="language-plaintext r highlighter-rouge"><div class="highlight"><pre class="highlight"><code>head(map, n=2)
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$`1`
  D1Mit18  c1.loc28  c1.loc29  c1.loc30  c1.loc31  c1.loc32  c1.loc33  c1.loc34 
     27.3      28.3      29.3      30.3      31.3      32.3      33.3      34.3 
 c1.loc35  c1.loc36  c1.loc37  c1.loc38  c1.loc39  c1.loc40  c1.loc41  c1.loc42 
     35.3      36.3      37.3      38.3      39.3      40.3      41.3      42.3 
 c1.loc43  c1.loc44  c1.loc45  c1.loc46  c1.loc47  c1.loc48  c1.loc49  c1.loc50 
     43.3      44.3      45.3      46.3      47.3      48.3      49.3      50.3 
 c1.loc51   D1Mit80  c1.loc52  c1.loc53  c1.loc54  c1.loc55  c1.loc56  c1.loc57 
     51.3      51.4      52.3      53.3      54.3      55.3      56.3      57.3 
 c1.loc58  c1.loc59  c1.loc60  c1.loc61  c1.loc62  c1.loc63  c1.loc64  c1.loc65 
     58.3      59.3      60.3      61.3      62.3      63.3      64.3      65.3 
 c1.loc66  c1.loc67  c1.loc68  c1.loc69  c1.loc70  c1.loc71  c1.loc72  c1.loc73 
     66.3      67.3      68.3      69.3      70.3      71.3      72.3      73.3 
 c1.loc74  c1.loc75  c1.loc76  c1.loc77  c1.loc78  c1.loc79  c1.loc80  c1.loc81 
     74.3      75.3      76.3      77.3      78.3      79.3      80.3      81.3 
 c1.loc82  c1.loc83  c1.loc84  c1.loc85  c1.loc86  c1.loc87  c1.loc88  c1.loc89 
     82.3      83.3      84.3      85.3      86.3      87.3      88.3      89.3 
 c1.loc90  c1.loc91  c1.loc92  c1.loc93  c1.loc94  c1.loc95  c1.loc96  c1.loc97 
     90.3      91.3      92.3      93.3      94.3      95.3      96.3      97.3 
 c1.loc98  c1.loc99 c1.loc100 c1.loc101 c1.loc102 c1.loc103 c1.loc104 c1.loc105 
     98.3      99.3     100.3     101.3     102.3     103.3     104.3     105.3 
c1.loc106 c1.loc107 c1.loc108 c1.loc109 c1.loc110   D1Mit17 
    106.3     107.3     108.3     109.3     110.3     110.4 

$`2`
D2Mit379 c2.loc39 c2.loc40 c2.loc41 c2.loc42 c2.loc43 c2.loc44 c2.loc45 
    38.3     39.3     40.3     41.3     42.3     43.3     44.3     45.3 
c2.loc46 c2.loc47  D2Mit75 c2.loc48 c2.loc49 c2.loc50 c2.loc51 c2.loc52 
    46.3     47.3     48.1     48.3     49.3     50.3     51.3     52.3 
c2.loc53 c2.loc54 c2.loc55 c2.loc56  D2Mit17 c2.loc57 D2Mit304 c2.loc58 
    53.3     54.3     55.3     56.3     56.8     57.3     58.0     58.3 
c2.loc59 c2.loc60 c2.loc61 c2.loc62 c2.loc63 c2.loc64 c2.loc65 c2.loc66 
    59.3     60.3     61.3     62.3     63.3     64.3     65.3     66.3 
c2.loc67 c2.loc68 c2.loc69 c2.loc70 c2.loc71 c2.loc72  D2Mit48 
    67.3     68.3     69.3     70.3     71.3     72.3     73.2 
</code></pre></div></div>

<p>Notice that pseudomarkers are now spaced at 1 cM intervals from genotyped markers. The argument <code class="language-plaintext highlighter-rouge">step=1</code> generated pseudomarkers at these intervals.</p>

<p>Next we use <code class="language-plaintext highlighter-rouge">calc_genoprob()</code> to calculate the QTL genotype probabilities.</p>

<div class="language-plaintext r highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pr &lt;- calc_genoprob(cross=iron, map=map, error_prob=0.002)
</code></pre></div></div>

<p>The argument <code class="language-plaintext highlighter-rouge">error_prob</code> supplies an assumed genotyping error probability of 0.002. If a value for <code class="language-plaintext highlighter-rouge">error_prob</code> is not supplied, the default probability is 0.0001.</p>

<p>Recall that the result of <code class="language-plaintext highlighter-rouge">calc_genoprob</code>, <code class="language-plaintext highlighter-rouge">pr</code>, is a list of three-dimensional arrays (one per chromosome).</p>

<div class="language-plaintext r highlighter-rouge"><div class="highlight"><pre class="highlight"><code>names(pr)
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code> [1] "1"  "2"  "3"  "4"  "5"  "6"  "7"  "8"  "9"  "10" "11" "12" "13" "14" "15"
[16] "16" "17" "18" "19" "X" 
</code></pre></div></div>

<p>Each three-dimensional array of probabilities is arranged as individuals × genotypes × positions. Have a look at the names of each of the three dimensions for chromosome 19.</p>

<div class="language-plaintext r highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dimnames(pr$`19`)
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[[1]]
  [1] "1"   "2"   "3"   "4"   "5"   "6"   "7"   "8"   "9"   "10"  "11"  "12" 
 [13] "13"  "14"  "15"  "16"  "17"  "18"  "19"  "20"  "21"  "22"  "23"  "24" 
 [25] "25"  "26"  "27"  "28"  "29"  "30"  "31"  "32"  "33"  "34"  "35"  "36" 
 [37] "37"  "38"  "39"  "40"  "41"  "42"  "43"  "44"  "45"  "46"  "47"  "48" 
 [49] "49"  "50"  "51"  "52"  "53"  "54"  "55"  "56"  "57"  "58"  "59"  "60" 
 [61] "61"  "62"  "63"  "64"  "65"  "66"  "67"  "68"  "69"  "70"  "71"  "72" 
 [73] "73"  "74"  "75"  "76"  "77"  "78"  "79"  "80"  "81"  "82"  "83"  "84" 
 [85] "85"  "86"  "87"  "88"  "89"  "90"  "91"  "92"  "93"  "94"  "95"  "96" 
 [97] "97"  "98"  "99"  "100" "101" "102" "103" "104" "105" "106" "107" "108"
[109] "109" "110" "111" "112" "113" "114" "115" "116" "117" "118" "119" "120"
[121] "121" "122" "123" "124" "125" "126" "127" "128" "129" "130" "131" "132"
[133] "133" "134" "135" "136" "137" "138" "139" "140" "141" "142" "143" "144"
[145] "145" "146" "147" "148" "149" "150" "151" "152" "153" "154" "155" "156"
[157] "157" "158" "159" "160" "161" "162" "163" "164" "165" "166" "167" "168"
[169] "169" "170" "171" "172" "173" "174" "175" "176" "177" "178" "179" "180"
[181] "181" "182" "183" "184" "185" "186" "187" "188" "189" "190" "191" "192"
[193] "193" "194" "195" "196" "197" "198" "199" "200" "201" "202" "203" "204"
[205] "205" "206" "207" "208" "209" "210" "211" "212" "213" "214" "215" "216"
[217] "217" "218" "219" "220" "221" "222" "223" "224" "225" "226" "227" "228"
[229] "229" "230" "231" "232" "233" "234" "235" "236" "237" "238" "239" "240"
[241] "241" "242" "243" "244" "245" "246" "247" "248" "249" "250" "251" "252"
[253] "253" "254" "255" "256" "257" "258" "259" "260" "261" "262" "263" "264"
[265] "265" "266" "267" "268" "269" "270" "271" "272" "273" "274" "275" "276"
[277] "277" "278" "279" "280" "281" "282" "283" "284"

[[2]]
[1] "SS" "SB" "BB"

[[3]]
 [1] "D19Mit68"  "c19.loc4"  "c19.loc5"  "c19.loc6"  "c19.loc7"  "c19.loc8" 
 [7] "c19.loc9"  "c19.loc10" "c19.loc11" "c19.loc12" "c19.loc13" "c19.loc14"
[13] "c19.loc15" "c19.loc16" "c19.loc17" "c19.loc18" "c19.loc19" "c19.loc20"
[19] "c19.loc21" "c19.loc22" "c19.loc23" "c19.loc24" "c19.loc25" "c19.loc26"
[25] "c19.loc27" "c19.loc28" "c19.loc29" "c19.loc30" "c19.loc31" "c19.loc32"
[31] "c19.loc33" "c19.loc34" "c19.loc35" "c19.loc36" "c19.loc37" "D19Mit37" 
</code></pre></div></div>

<p>View the first three rows of genotype probabilities for the first genotyped marker on chromosome 19, and the two adjacent pseudomarkers located at 1 cM intervals away. Compare the probabilities for each pseudomarker genotype with those of the genotyped marker.</p>

<div class="language-plaintext r highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(pr$`19`)[1:3,,"D19Mit68"] # genotyped marker
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>            SS          SB           BB
1 0.0009976995 0.003298162 0.9957041387
2 0.2500000000 0.500000000 0.2500000000
3 0.0003029243 0.999394151 0.0003029243
</code></pre></div></div>

<div class="language-plaintext r highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(pr$`19`)[1:3,,"c19.loc4"] # pseudomarker 1 cM away
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>           SS         SB          BB
1 0.001080613 0.03581825 0.963101136
2 0.250000000 0.50000000 0.250000000
3 0.006141104 0.98771779 0.006141104
</code></pre></div></div>

<div class="language-plaintext r highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(pr$`19`)[1:3,,"c19.loc5"] # the next pseudomarker
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>           SS         SB         BB
1 0.001342511 0.06759555 0.93106194
2 0.250000000 0.50000000 0.25000000
3 0.011589058 0.97682188 0.01158906
</code></pre></div></div>

<p>We can also view the genotype probabilities using <a href="https://github.com/rqtl/qtl2/blob/master/R/plot_genoprob.R">plot_genoprob</a>. The arguments to this function specify:</p>

<ol>
  <li>pr: the genotype probabilities,</li>
  <li>map: the marker map,</li>
  <li>ind: the index of the individual to plot,</li>
  <li>chr: the index of the chromosome to plot.</li>
</ol>

<div class="language-plaintext r highlighter-rouge"><div class="highlight"><pre class="highlight"><code>plot_genoprob(pr, map, ind = 1, chr = 19)
</code></pre></div></div>

<div class="figure" style="text-align: center">
<img src="../fig/rmd-03-plot_genoprob-1.png" alt="plot of chunk plot_genoprob" />
<p class="caption">plot of chunk plot_genoprob</p>
</div>

<p>The coordinates along chromosome 19 are shown on the horizontal axis and the three genotypes are shown on the vertical axis. Higher genotype probabilities are plotted in darker shades. This mouse has a BB genotype on the proximal end of the chromosome and transitions to SB toward the distal end.</p>

<blockquote class="challenge">
  <h2 id="challenge-1">Challenge 1</h2>
  <p>Find a partner and explain why calculating genotype probabilities is the first step in QTL analysis. Why do you need to insert pseudomarkers first? Listen to your partner’s explanation, then write your responses in the collaborative document.</p>

  <blockquote class="solution">
    <h2 id="solution-to-challenge-1">Solution to Challenge 1</h2>

  </blockquote>
</blockquote>

<blockquote class="challenge">
  <h2 id="challenge-2">Challenge 2</h2>
  <p>1). Load a second dataset from Arabidopsis recombinant inbred lines 
(<a href="https://www.genetics.org/content/195/3/1077">Moore et al, Genetics, 2013</a>) 
in a study of plant root response to gravity (gravitropism).<br />
<code class="language-plaintext highlighter-rouge">grav &lt;- read_cross2(file = system.file('extdata', 'grav2.zip', package = 'qtl2'))</code><br />
2). How many individuals were in the study? How many phenotypes? 
How many chromosomes?<br />
3). Insert pseudomarkers at 1cM intervals and save the results 
to an object called <code class="language-plaintext highlighter-rouge">gravmap</code>. Have a look at the first chromosome.<br />
4). Calculate genotype probabilities and save the results to an object 
called <code class="language-plaintext highlighter-rouge">gravpr</code>. View the genotypes for the first three markers and 
pseudomarkers on chromosome 1 for the first five individuals.</p>

  <blockquote class="solution">
    <h2 id="solution-to-challenge-2">Solution to Challenge 2</h2>

    <p>1). <code class="language-plaintext highlighter-rouge">grav &lt;- read_cross2(file = system.file('extdata', 'grav2.zip', package = 'qtl2'))</code><br />
2). <code class="language-plaintext highlighter-rouge">summary(grav)</code> <br />
3). <code class="language-plaintext highlighter-rouge">gravmap &lt;- insert_pseudomarkers(map = grav$gmap, step = 1)</code><br />
followed by <code class="language-plaintext highlighter-rouge">head(gravmap, n=1)</code> <br />
4). <code class="language-plaintext highlighter-rouge">gravpr  &lt;- calc_genoprob(cross = grav, map = gravmap)</code> followed by<br />
<code class="language-plaintext highlighter-rouge">(gravpr$</code><code class="language-plaintext highlighter-rouge">1</code><code class="language-plaintext highlighter-rouge">)[1:5,,"PVV4"]</code>, <code class="language-plaintext highlighter-rouge">(gravpr$</code>1<code class="language-plaintext highlighter-rouge">)[1:5,,"c1.loc1"]</code>, and<br />
<code class="language-plaintext highlighter-rouge">(gravpr$</code>1<code class="language-plaintext highlighter-rouge">)[1:5,,"c1.loc2"]</code></p>
  </blockquote>
</blockquote>

<blockquote class="challenge">
  <h2 id="challenge-3">Challenge 3</h2>
  <p>Calculate genotype probabilities for a different data set from the 
<a href="https://github.com/rqtl/qtl2data">qtl2 data repository</a>, this one from a study 
of obesity and diabetes in a C57BL/6 (B6) × BTBR intercross. <br />
1). Create a new script in RStudio with File -&gt; New File -&gt; R Script.<br />
2)  Download the B6 x BTBR zip file from the 
<a href="https://github.com/rqtl/qtl2data">qtl2 data repository</a> into an object 
called <code class="language-plaintext highlighter-rouge">b6btbr</code> by running this code:<br />
<code class="language-plaintext highlighter-rouge">b6btbr &lt;- read_cross2(file = "https://raw.githubusercontent.com/rqtl/qtl2data/master/B6BTBR/b6btbr.zip")</code><br />
3). View a summary of the <code class="language-plaintext highlighter-rouge">b6btbr</code> data. How many individuals? phenotypes? 
chromosomes? markers?<br />
4). View the genetic map for the <code class="language-plaintext highlighter-rouge">b6btbr</code> data.<br />
5). Insert pseudomarkers at 2 cM intervals. Assign the results to an object 
called <code class="language-plaintext highlighter-rouge">b6btbrmap</code>.  <br />
6). Calculate genotype probabilities assuming a genotyping error probability 
of 0.001. Assign the results to an object called <code class="language-plaintext highlighter-rouge">b6btbrpr</code>.  <br />
7). View the first several rows of genotype probabilities for 
any marker on chromosome 18.</p>

  <blockquote class="solution">
    <h2 id="solution-to-challenge-3">Solution to Challenge 3</h2>

    <p>1). Create a new script in RStudio with File -&gt; New File -&gt; R Script.<br />
2). <code class="language-plaintext highlighter-rouge">b6btbr &lt;- read_cross2(file = "https://raw.githubusercontent.com/rqtl/qtl2data/master/B6BTBR/b6btbr.zip</code><br />
3). <code class="language-plaintext highlighter-rouge">summary(b6btbr)</code> shows 544 individuals, 3 phenotypes, 20 chromosomes, 2057 markers.<br />
4). <code class="language-plaintext highlighter-rouge">b6btbr$gmap</code><br />
5). <code class="language-plaintext highlighter-rouge">b6btbrmap &lt;- insert_pseudomarkers(map=b6btbr$gmap, step=2)</code><br />
6). <code class="language-plaintext highlighter-rouge">b6btbrpr &lt;- calc_genoprob(cross=b6btbr, map=b6btbrmap, error_prob=0.001)</code><br />
7). <code class="language-plaintext highlighter-rouge">dimnames((b6btbrpr$</code>18<code class="language-plaintext highlighter-rouge">))</code> shows all marker names for chromosome 18. <code class="language-plaintext highlighter-rouge">head((b6btbrpr$</code>18<code class="language-plaintext highlighter-rouge">)[,,"c18.loc48"])</code> gives genotype probabilities for an example pseudomarker, while <code class="language-plaintext highlighter-rouge">head((b6btbrpr$</code>18<code class="language-plaintext highlighter-rouge">)[,,"rs6338896"])</code>  gives genotype probabilities for a genotyped marker.</p>
  </blockquote>
</blockquote>

<p><strong>Parallel calculations (optional)</strong> To speed up the calculations with large datasets on a multi-core machine, you can use the argument <code class="language-plaintext highlighter-rouge">cores</code>. With <code class="language-plaintext highlighter-rouge">cores=0</code>, the number of available cores will be detected via <code class="language-plaintext highlighter-rouge">parallel::detectCores()</code>. Otherwise, specify the number of cores as a positive integer.</p>

<div class="language-plaintext r highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pr &lt;- calc_genoprob(cross=iron, map=map, error_prob=0.002, cores=4)
</code></pre></div></div>

<p><strong>Allele probabilities (optional)</strong> The genome scan functions use genotype probabilities as well as a matrix of phenotypes. If you wished to perform a genome scan via an additive allele model, you would first convert the genotype probabilities to allele probabilities, using the function <code class="language-plaintext highlighter-rouge">genoprob_to_alleleprob()</code>.</p>

<div class="language-plaintext r highlighter-rouge"><div class="highlight"><pre class="highlight"><code>apr &lt;- genoprob_to_alleleprob(probs=pr)
</code></pre></div></div>

<p>The figure below shows genotype and allele probabilities for 3 samples. In the Diversity Outbred, 
there are 36 possible genotype states 
(AA, AB, AC, …, BB, BC, BD, …, CC, CD, CE, …, DD, DE, DF, …, EE,…) or 8 + 7 + 6 + 5 + 4 + 3 + 2 + 1.
The first SNP below has genotype BB. In the table describing alleles (8 state founder probabilities), the 
probability that this SNP has a B allele is 1. The 2nd SNP has genotype BH, so the allele table shows a 
probability of 0.5 for B and 0.5 for H. The third SNP is either BG or BH, and has a probability of 0.5
for each of these genotypes. The allele table shows a probability of 0.5 for allele B, and 0.25 for both
G and H.</p>

<p><img src="../fig/geno-to-allele-probs.png" alt="" /></p>


<blockquote class="keypoints">
  <h2>Key Points</h2>
  <ul>
    
    <li><p>The first step in QTL analysis is to calculate genotype probabilities.</p>
</li>
    
    <li><p>Insert pseudomarkers to calculate QTL at positions between genotyped markers.</p>
</li>
    
    <li><p>Calculate genotype probabilities between genotyped markers with calc_genoprob().</p>
</li>
    
  </ul>
</blockquote>

</article>

<div class="row">
  <div class="col-md-1">
    <h3>
      
      <a href="../02-input-file-format/"><span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span><span class="sr-only">previous episode</span></a>
      
    </h3>
  </div>
  <div class="col-md-10">
    
  </div>
  <div class="col-md-1">
    <h3>
      
      <a href="../04-special-x-covar/"><span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span><span class="sr-only">next episode</span></a>
      
    </h3>
  </div>
</div>


      
      
<footer>
  <div class="row">
    <div class="col-md-6" align="left">
      <h4>
	Copyright &copy; 2016–2025
	
      </h4>
    </div>
    <div class="col-md-6" align="right">
      <h4>
	
	
	<a href="/edit/gh-pages/_episodes_rmd/03-calc-genoprob.Rmd">Edit on GitHub</a>
	
	
	/
	<a href="/blob/gh-pages/CONTRIBUTING.md">Contributing</a>
	/
	<a href="/">Source</a>
	/
	<a href="/blob/gh-pages/CITATION">Cite</a>
	/
	<a href="mailto:susan.mcclatchy@jax.org">Contact</a>
      </h4>
    </div>
  </div>
</footer>

      
    </div>
    
<script src="../assets/js/jquery.min.js"></script>
<script src="../assets/js/bootstrap.min.js"></script>
<script src="../assets/js/lesson.js"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-37305346-2', 'auto');
  ga('send', 'pageview');
</script>

  </body>
</html>
