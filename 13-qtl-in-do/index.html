<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="last-modified" content="2025-11-22 10:15:12 +0000">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- meta "search-domain" used for google site search function google_search() -->
    <meta name="search-domain" value="">
    <link rel="stylesheet" type="text/css" href="../assets/css/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/bootstrap-theme.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/lesson.css" />
    
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
	<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
	<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	<![endif]-->
    <title>Quantitative Trait Mapping: QTL analysis in Diversity Outbred Mice</title>
  </head>
  <body>
    <div class="container">
      
<nav class="navbar navbar-default">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      
      

      
      <a class="navbar-brand" href="../">Home</a>

    </div>
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">

	
        <li><a href="../conduct/">Code of Conduct</a></li>

	
        
        <li><a href="../setup/">Setup</a></li>
        <li class="dropdown">
          <a href="../" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Episodes <span class="caret"></span></a>
          <ul class="dropdown-menu">
            
            <li><a href="../02-input-file-format/">Input File Format</a></li>
            
            <li><a href="../03-calc-genoprob/">Calculating Genotype Probabilities</a></li>
            
            <li><a href="../04-special-x-covar/">Special covariates for the X chromosome</a></li>
            
            <li><a href="../05-perform-genome-scan/">Performing a genome scan</a></li>
            
            <li><a href="../06-perform-perm-test/">Performing a permutation test</a></li>
            
            <li><a href="../07-find-lod-peaks/">Finding LOD peaks</a></li>
            
            <li><a href="../08-calc-kinship/">Calculating A Kinship Matrix</a></li>
            
            <li><a href="../09-perform-genome-scan-lmm/">Performing a genome scan with a linear mixed model</a></li>
            
            <li><a href="../10-perform-genome-scan-bin/">Performing a genome scan with binary traits</a></li>
            
            <li><a href="../11-est-qtl-effects/">Estimated QTL effects</a></li>
            
            <li><a href="../12-snp-assoc/">SNP association mapping</a></li>
            
            <li><a href="../13-qtl-in-do/">QTL analysis in Diversity Outbred Mice</a></li>
            
	    <li role="separator" class="divider"></li>
            <li><a href="../aio/">All in one page (Beta)</a></li>
          </ul>
        </li>
	

	
	
        <li class="dropdown">
          <a href="../" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Extras <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="../reference/">Reference</a></li>
            
            <li><a href="../about/">About</a></li>
            
            <li><a href="../discuss/">Discussion</a></li>
            
            <li><a href="../figures/">Figures</a></li>
            
            <li><a href="../guide/">Instructor Notes</a></li>
            
          </ul>
        </li>
	

	
        <li><a href="../license/">License</a></li>
	
	
	<li><a href="/edit/gh-pages/_episodes_rmd/13-qtl-in-do.Rmd">Improve this page <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span></a></li>
	
	
      </ul>
      <form class="navbar-form navbar-right" role="search" id="search" onsubmit="google_search(); return false;">
        <div class="form-group">
          <input type="text" id="google-search" placeholder="Search..." aria-label="Google site search">
        </div>
      </form>
    </div>
  </div>
</nav>


<div class="row">
  <div class="col-md-1">
    <h3>
      
      <a href="../12-snp-assoc/"><span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span><span class="sr-only">previous episode</span></a>
      
    </h3>
  </div>
  <div class="col-md-10">
    
    <h3 class="maintitle"><a href="../">Quantitative Trait Mapping</a></h3>
    
  </div>
  <div class="col-md-1">
    <h3>
      
      <a href="../"><span class="glyphicon glyphicon-menu-up" aria-hidden="true"></span><span class="sr-only">lesson home</span></a>
      
    </h3>
  </div>
</div>

<article>
<div class="row">
  <div class="col-md-1">
  </div>
  <div class="col-md-10">
    <h1 class="maintitle">QTL analysis in Diversity Outbred Mice</h1>
  </div>
  <div class="col-md-1">
  </div>
</div>


<blockquote class="objectives">
  <h2>Overview</h2>

  <div class="row">
    <div class="col-md-3">
      <strong>Teaching:</strong> 30 min
      <br/>
      <strong>Exercises:</strong> 30 min
    </div>
    <div class="col-md-9">
      <strong>Questions</strong>
      <ul>
	
	<li><p>How do I bring together each step in the workflow?</p>
</li>
	
	<li><p>How is the workflow implemented in an actual study?</p>
</li>
	
      </ul>
    </div>
  </div>

  <div class="row">
    <div class="col-md-3">
    </div>
    <div class="col-md-9">
      <strong>Objectives</strong>
      <ul>
	
	<li><p>Work through an actual QTL mapping workflow from a published study.</p>
</li>
	
      </ul>
    </div>
  </div>

</blockquote>

<p>This tutorial will take you through the process of mapping a QTL and searching for candidate genes for DNA damage from benzene exposure. The adverse health effects of benzene, including leukemia and aplastic anemia, were first studied in occupational settings in which workers were exposed to high benzene concentrations. Environmental sources of benzene exposure typically come from the petrochemical industry, however, a person’s total exposure can be increased from cigarettes, consumer products, gas stations, and gasoline powered engines or tools stored at home.</p>

<p>Exposure thresholds for toxicants are often determined using animal models that have limited genetic diversity, including standard inbred and outbred rats and mice. These animal models fail to capture the influence of genetic diversity on toxicity response, an important component of human responses to chemicals such as benzene. The Diversity Outbred (DO) mice reflect a level of genetic diversity similar to that of humans.</p>

<p>The data comes from a toxicology study in which Diversity Outbred (DO) mice were exposed to benzene via inhalation for 6 hours a day, 5 days a week for 4 weeks  <a href="http://ehp.niehs.nih.gov/1408202/">(French, J. E., et al. (2015) <i>Environ Health Perspect</i> 123(3): 237-245)</a>. The study was conducted in two equally sized cohort of 300 male mice each, for a total of 600 mice. They were then sacrificed and reticulocytes (red blood cell precursors) were isolated from bone marrow. The number of micro-nucleated reticulocytes, a measure of DNA damage, was then measured in each mouse. The goal is to map gene(s) that influence the level of DNA damage in the bone marrow. 
<img src="../fig/benzene_study_design.png" alt="" /></p>

<h3 id="load-and-explore-the-data">Load and explore the data</h3>

<p>Make sure that you are in your scripts directory. If you’re not sure where you are working right now, you can check your working directory with <code class="language-plaintext highlighter-rouge">getwd()</code>. If you are not in your scripts directory, run <code class="language-plaintext highlighter-rouge">setwd("scripts")</code> in the Console or Session -&gt; Set Working Directory -&gt; Choose Directory in the RStudio menu to set your working directory to the scripts directory.</p>

<p>Once you are in your scripts directory, create a new R script with File -&gt; New File -&gt; R script, or use the +document icon at upper left.</p>

<p>The data for this tutorial has been saved as an R binary file that contains several data objects.  Load it in now by running the following command in your new script.</p>

<div class="language-plaintext r highlighter-rouge"><div class="highlight"><pre class="highlight"><code>load("../data/qtl2_demo.Rdata")
sessionInfo()
</code></pre></div></div>

<p>The call to <code class="language-plaintext highlighter-rouge">sessionInfo</code> provides information about the R version running on your machine and the R packages that are installed. This information can help you to troubleshoot. If you can’t load the data, try downloading the data again by copying and pasting the following into your browser: ftp://ftp.jax.org/dgatti/qtl2_workshop/qtl2_demo.Rdata</p>

<p>We loaded in three data objects. Check the Environment tab to see what was loaded.  You should see a phenotypes object called <code class="language-plaintext highlighter-rouge">pheno</code> with 598 observations (in rows) of 12 variables (in columns), an object called <code class="language-plaintext highlighter-rouge">map</code> (physical map), and an object called <code class="language-plaintext highlighter-rouge">probs</code> (genotype probabilities).</p>

<h4 id="phenotypes">Phenotypes</h4>
<p><code class="language-plaintext highlighter-rouge">pheno</code> is a data frame containing the phenotype data. Click on the triangle to the left of <code class="language-plaintext highlighter-rouge">pheno</code> in the Environment pane to view its contents. Run <code class="language-plaintext highlighter-rouge">names(pheno)</code> to list the variables.</p>

<p><strong>NOTE:</strong> the sample IDs must be in the rownames of <code class="language-plaintext highlighter-rouge">pheno</code>. For more information about data file format, see the <a href="../setup.md">Setup</a> instructions.</p>

<p><code class="language-plaintext highlighter-rouge">pheno</code> contains the sample ID, sex, the study cohort, the concentration of benzene and the proportion of bone marrow reticulocytes that were micro-nucleated <code class="language-plaintext highlighter-rouge">(prop.bm.MN.RET)</code>.  Note that the sample IDs are also stored in the rownames of <code class="language-plaintext highlighter-rouge">pheno</code>. In order to save time for this tutorial, we will only map with 598 samples from the 100 ppm dosing group.</p>

<blockquote class="challenge">
  <h2 id="challenge-1-look-at-the-data">Challenge 1 Look at the Data</h2>
  <p>Determine the dimensions of <code class="language-plaintext highlighter-rouge">pheno</code>.<br />
1). How many rows and columns does it have?<br />
2). What are the names of the variables it contains?<br />
3). What does the distribution of the <code class="language-plaintext highlighter-rouge">prop.bm.MN.RET</code> column look like? Is it normally distributed?</p>

  <blockquote class="solution">
    <h2 id="solution-to-challenge-1">Solution to Challenge 1</h2>
    <p><code class="language-plaintext highlighter-rouge">dim(pheno)</code><br />
1). <code class="language-plaintext highlighter-rouge">dim(pheno)[1]</code> gives the number of rows and <code class="language-plaintext highlighter-rouge">dim(pheno)[2]</code> the number of columns.
You can also use the structure command <code class="language-plaintext highlighter-rouge">str(pheno)</code>, which will tell you that this is a data frame with 598 observations of 12 variables. It will also list the 12 variable names for you.<br />
2). Use <code class="language-plaintext highlighter-rouge">colnames(pheno)</code> or <code class="language-plaintext highlighter-rouge">names(pheno)</code>, or click the triangle to the left of <code class="language-plaintext highlighter-rouge">pheno</code>
in the Environment tab.<br />
3). Use <code class="language-plaintext highlighter-rouge">hist(pheno$prop.bm.MN.RET)</code> to plot the distribution of the data. The data has a long right 
tail and is not normally distributed.</p>
  </blockquote>
</blockquote>

<p>Many statistical models, including the QTL mapping model in qtl2, expect that the incoming data will be normally distributed. You may use transformations such as log or square root to make your data more normally distributed. We will be mapping the proportion of micronucleated reticulocytes in bone marrow (<code class="language-plaintext highlighter-rouge">prop.bm.MN.RET</code>) and, since the data does not contain zeros or negative numbers, we will log transform the data. Here is a histogram of the untransformed data.</p>

<div class="language-plaintext r highlighter-rouge"><div class="highlight"><pre class="highlight"><code>hist(pheno$prop.bm.MN.RET, main = "Proportion of micronucleated reticulocytes")
</code></pre></div></div>

<div class="figure" style="text-align: center">
<img src="../fig/rmd-13-hist_untransformed-1.png" alt="plot of chunk hist_untransformed" />
<p class="caption">plot of chunk hist_untransformed</p>
</div>

<p>Apply the <code class="language-plaintext highlighter-rouge">log()</code> function to this data.</p>

<div class="language-plaintext r highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pheno$log.MN.RET &lt;- log(pheno$prop.bm.MN.RET)
</code></pre></div></div>

<p>Now, let’s make a histogram of the log-transformed data.</p>

<div class="language-plaintext r highlighter-rouge"><div class="highlight"><pre class="highlight"><code>hist(pheno$log.MN.RET, main = "Proportion of micronucleated reticulocytes (log-transformed)")
</code></pre></div></div>

<div class="figure" style="text-align: center">
<img src="../fig/rmd-13-hist_log_transform-1.png" alt="plot of chunk hist_log_transform" />
<p class="caption">plot of chunk hist_log_transform</p>
</div>

<p>This looks much better!</p>

<p>Some researchers are concerned about the reproducibility of DO studies. The argument is that each DO mouse is unique and therefore can never be reproduced. But this misses the point of using the DO. While mice are the sampling unit, in QTL mapping we are sampling the founder alleles at each locus. An average of 1/8th of the alleles should come from each founder at any given locus. Also, DO mice are a <em>population</em> of mice, not a single strain. While it is true that results in an individual DO mouse may not be reproducible, results at the population level should be reproducible. This is similar to the human population in that results from one individual may not represent all humans, but results at the population level should be reproducible.</p>

<p>The benzene inhalation study was conducted in two separate cohorts (termed <em>Study</em> in the <code class="language-plaintext highlighter-rouge">pheno</code> object). Below, we plot the proportion of micronucleated reticulocytes in bone marrow versus the benzene concentration for each study cohort. As you can see, while individual mice have varying micronucleated reticulocytes, there is a dose-dependent increase in micronucleated reticulocytes in both cohorts. This is an example of how results in the DO reproduce at the population level.</p>

<p><img src="../fig/bm_mnret_by_dose_cohort.png" alt="" /></p>

<h4 id="the-marker-map">The Marker Map</h4>

<p>The marker map for each chromosome is stored in the <code class="language-plaintext highlighter-rouge">map</code> object. Each list element is a numeric vector with each marker position in megabases (Mb). This is used to plot the LOD scores calculated at each marker during QTL mapping.</p>

<p>The markers are from a genotyping array called the Mouse Universal Genotyping Array (MUGA) and contains 7,856 SNP markers. Marker locations for the MUGA and other mouse arrays are available from <a href="ftp://ftp.jax.org/MUGA">The Jackson Laboratory’s FTP site</a>.</p>

<p>Look at the structure of <code class="language-plaintext highlighter-rouge">map</code> in the Environment tab by clicking the triangle to the left or by running <code class="language-plaintext highlighter-rouge">str(map)</code> in the Console.</p>

<blockquote class="challenge">
  <h2 id="challenge-2-data-dimensions-ii">Challenge 2 Data Dimensions II</h2>
  <p>1). Determine the length of <code class="language-plaintext highlighter-rouge">map</code>.<br />
2). How many markers are on chromosome 1?</p>

  <blockquote class="solution">
    <h2 id="solution-to-challenge-2">Solution to Challenge 2</h2>
    <p>1). <code class="language-plaintext highlighter-rouge">length(map)</code><br />
2). <code class="language-plaintext highlighter-rouge">length(map[[1]])</code></p>
  </blockquote>
</blockquote>

<h4 id="genotype-allele-probabilities">Genotype (allele) probabilities</h4>
<p>Each element of <code class="language-plaintext highlighter-rouge">probs</code> is a 3 dimensional array containing the founder allele dosages for each sample at each marker on one chromosome. These probabilities have been pre-calculated for you, so you can skip the step for <a href="https://smcclatchy.github.io/mapping/03-calc-genoprob/">calculating genotype probabilities</a> and the optional step for calculating allele probabilities.</p>

<p>Next, we look at the dimensions of <code class="language-plaintext highlighter-rouge">probs</code> for chromosome 1:</p>

<div class="language-plaintext r highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dim(probs[[1]])
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 590   8 537
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">probs</code> is a three dimensional array containing the proportion of each founder haplotype at each marker for each DO sample.  The 590 samples are in the first dimension, the 8 founders in the second and the 537 markers along chromosome 1 are in the third dimension.
Let’s return to the <code class="language-plaintext highlighter-rouge">probs</code> object. Look at the contents for the first 500 markers of one sample.</p>

<p><strong>NOTE:</strong> the sample IDs must be in the rownames of <code class="language-plaintext highlighter-rouge">probs</code>.</p>

<div class="language-plaintext r highlighter-rouge"><div class="highlight"><pre class="highlight"><code>plot_genoprob(probs, map, ind = 1, chr = 1)
</code></pre></div></div>

<div class="figure" style="text-align: center">
<img src="../fig/rmd-13-geno_plot-1.png" alt="plot of chunk geno_plot" />
<p class="caption">plot of chunk geno_plot</p>
</div>

<p>In the plot above, the founder contributions, which range between 0 and 1, are colored from white (= 0) to black (= 1.0). A value of ~0.5 is grey. The markers are on the X-axis and the eight founders (denoted by the letters A through H) on the Y-axis. Starting at the left, we see that this sample has genotype BB because the row for B is black, indicating values of 1.0. Moving along the genome to the right, the genotype becomes CE where rows C and E are gray, followed by CD, FH, AG, GH, etc. The values at each marker sum to 1.0.</p>

<h3 id="calculating-a-kinship-matrix"><a href="https://smcclatchy.github.io/mapping/04-calc-kinship/">Calculating A Kinship Matrix</a></h3>
<p>Next, we need to create a matrix that accounts for the kinship relationships between the mice. We do this by looking at the correlation between the founder haplotypes for each sample at each SNP. For each chromosome, we create a kinship matrix using all markers <em>except</em> the ones on the current chromosome using the loco (leave-one-chromosome-out) method. Simulations suggest that mapping using this approach increases the power to detect QTL.</p>

<div class="language-plaintext r highlighter-rouge"><div class="highlight"><pre class="highlight"><code>K &lt;- calc_kinship(probs = probs, type = "loco")
</code></pre></div></div>

<p>Kinship values between pairs of samples range between 0 (no relationship) and 1.0 (completely identical). Let’s look at the kinship matrix.</p>

<div class="language-plaintext r highlighter-rouge"><div class="highlight"><pre class="highlight"><code>n_samples &lt;- 50
heatmap(K[[1]][1:n_samples, 1:n_samples])
</code></pre></div></div>

<div class="figure" style="text-align: center">
<img src="../fig/rmd-13-kinship_probs-1.png" alt="plot of chunk kinship_probs" />
<p class="caption">plot of chunk kinship_probs</p>
</div>

<p>The figure above shows kinship between all pairs of samples. Light yellow indicates low kinship and dark red indicates higher kinship. Orange values indicate varying levels of kinship between 0 and 1. The dark red diagonal of the matrix indicates that each sample is identical to itself. The orange blocks along the diagonal may indicate close relatives (i.e. siblings or cousins).</p>

<h4 id="covariates">Covariates</h4>
<p>Next, we need to create additive covariates that will be used in the mapping model. We will use study cohort as a covariate in the mapping model. If we were mapping with <em>all</em> mice, we would also add benzene concentration to the model. This study contained only male mice, but in most cases, you would include sex as an additive covariate as well.</p>

<div class="language-plaintext r highlighter-rouge"><div class="highlight"><pre class="highlight"><code>addcovar &lt;- model.matrix(~Study, data = pheno)[,-1]
</code></pre></div></div>

<p>The code above copies the <code class="language-plaintext highlighter-rouge">rownames(pheno)</code> to <code class="language-plaintext highlighter-rouge">rownames(addcovar)</code> as a side-effect.</p>

<p><strong>NOTE:</strong> the sample IDs must be in the rownames of <code class="language-plaintext highlighter-rouge">pheno</code>, <code class="language-plaintext highlighter-rouge">addcovar</code>, <code class="language-plaintext highlighter-rouge">genoprobs</code> and <code class="language-plaintext highlighter-rouge">K</code>. <code class="language-plaintext highlighter-rouge">qtl2</code> uses the sample IDs to align the samples between objects. For more information about data file format, see <a href="http://kbroman.org/qtl2/assets/vignettes/input_files.html">Karl Broman’s vignette on input file format</a>.</p>

<h3 id="performing-a-genome-scan"><a href="https://smcclatchy.github.io/mapping/06-perform-genome-scan/">Performing a genome scan</a></h3>

<p>Before we run the mapping function, let’s look at the mapping model. At each marker on the genotyping array, we will fit a model that regresses the phenotype (micronucleated reticulocytes) on covariates and the founder allele proportions.</p>

<p><img src="../fig/equation1.png" alt="" /></p>

<p>where:</p>

<ul>
<li><i>y<sub>i</sub></i> is the phenotype for mouse <i>i</i>,</li>
  <li><i>&beta;<sub>s</sub></i> is the effect of study cohort,</li>
  <li><i>s<sub>i</sub></i> is the study cohort for mouse <i>i</i>,</li>
  <li><i>&beta;<sub>j</sub></i> is the effect of founder allele <i>j</i>,</li>
  <li><i>g<sub>ij</sub></i> is the probability that mouse <i>i</i> carries an allele from founder <i>j</i>,</li>
  <li><i>&lambda;<sub>i</sub></i> is an adjustment for kinship-induced correlated errors for mouse <i>i</i>,</li>
  <li><i>&epsilon;<sub>i</sub></i> is the residual error for mouse <i>i</i>.</li>
  </ul>

<p>Note that this model will give us an estimate of the effect of each founder allele at each marker. There are eight founder strains that contributed to the DO, so we will get eight founder allele effects.</p>

<p>There are almost 600 samples in this data set and it may take several minutes to map one trait. In order to save some time, we will map using only the samples in the 100 ppm concentration group.</p>

<div class="language-plaintext r highlighter-rouge"><div class="highlight"><pre class="highlight"><code>c100 &lt;- which(pheno$Conc == 100)
</code></pre></div></div>

<p>In order to map the proportion of bone marrow reticulocytes that were micro-nucleated, you will use the <a href="https://github.com/rqtl/qtl2/blob/master/R/plot_scan1.R">scan1</a> function. To see the arguments for <a href="https://github.com/rqtl/qtl2/blob/master/R/plot_scan1.R">scan1</a>, you can type <code class="language-plaintext highlighter-rouge">help(scan1)</code>. First, let’s map the <em>untransformed</em> phenotype. (Recall that we log-transformed it above).</p>

<div class="language-plaintext r highlighter-rouge"><div class="highlight"><pre class="highlight"><code>index &lt;- which(colnames(pheno) == "prop.bm.MN.RET")
qtl &lt;- scan1(genoprobs = probs, pheno = pheno[c100,index, drop = FALSE], kinship = K, addcovar = addcovar)
</code></pre></div></div>

<p>Next, we plot the genome scan.</p>

<div class="language-plaintext r highlighter-rouge"><div class="highlight"><pre class="highlight"><code>plot_scan1(x = qtl, map = map, main = "Proportion of Micro-nucleated Bone Marrow Reticulocytes")
</code></pre></div></div>

<div class="figure" style="text-align: center">
<img src="../fig/rmd-13-qtl_plot-1.png" alt="plot of chunk qtl_plot" />
<p class="caption">plot of chunk qtl_plot</p>
</div>

<blockquote class="challenge">
  <h2 id="challenge-3-how-does-a-log-tranformation-change-the-qtl-plot">Challenge 3 How does a log-tranformation change the QTL plot?</h2>
  <p>1). Perform a genome scan on the column called <code class="language-plaintext highlighter-rouge">log.MN.RET</code>. (Hint: set <code class="language-plaintext highlighter-rouge">index</code> to the column index in <code class="language-plaintext highlighter-rouge">pheno</code>.)<br />
2). How does the LOD score for the peak on Chr 10 change?</p>
  <blockquote class="solution">
    <h2 id="solution-to-challenge-3">Solution to Challenge 3</h2>
    <p>1). <code class="language-plaintext highlighter-rouge">index &lt;- which(colnames(pheno) == "prop.bm.MN.RET")</code><br />
<code class="language-plaintext highlighter-rouge">qtl &lt;- scan1(genoprobs = probs, pheno = pheno[c100,index, drop = FALSE], kinship = K, addcovar = addcovar)</code><br />
<code class="language-plaintext highlighter-rouge">plot_scan1(x = qtl, map = map, main = "Log-Transformed BM micronucleated reticulocytes")</code><br />
2). The LOD increases from ~16 to ~26.</p>
  </blockquote>
</blockquote>

<p>This challenge shows the importance of looking at your data and transforming it to meet the expectations of the mapping model. In this case, a log transformation improved the model fit and increased the LOD score. We will continue the rest of this lesson using the log-transformed data. Set your <code class="language-plaintext highlighter-rouge">index</code> variable equal to the column index of <code class="language-plaintext highlighter-rouge">log.MN.RET</code>. Redo the genome scan with the log-transformed reticulocytes.</p>

<div class="language-plaintext r highlighter-rouge"><div class="highlight"><pre class="highlight"><code>index &lt;- which(colnames(pheno) == "log.MN.RET")
qtl &lt;- scan1(genoprobs = probs, pheno = pheno[c100, index,  drop = FALSE], kinship = K, addcovar = addcovar)
</code></pre></div></div>

<h3 id="performing-a-permutation-test"><a href="https://smcclatchy.github.io/mapping/10-perform-perm-test/">Performing a permutation test</a></h3>

<p>There is clearly a large peak on Chr 10. Next, we must assess its statistical significance. This is most commonly done via <a href="http://www.genetics.org/content/178/1/609.long">permutation</a>. We advise running at least 1,000 permutations to obtain significance thresholds. In the interest of time, we perform 100 permutations here.</p>

<div class="language-plaintext r highlighter-rouge"><div class="highlight"><pre class="highlight"><code>perms &lt;- scan1perm(genoprobs = probs, pheno = pheno[c100,index, drop = FALSE], addcovar = addcovar, n_perm = 100)
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">perms</code> object contains the maximum LOD score from each genome scan of permuted data.</p>

<blockquote class="challenge">
  <h2 id="challenge-4-what-is-significant">Challenge 4 What is significant?</h2>
  <p>1). Create a histogram of the LOD scores <code class="language-plaintext highlighter-rouge">perms</code>. Hint: use the <code class="language-plaintext highlighter-rouge">hist()</code> function.<br />
2). Estimate the value of the LOD score at the 95th percentile.<br />
3). Then find the value of the LOD score at the 95th percentile using the <code class="language-plaintext highlighter-rouge">summary()</code> function.</p>
  <blockquote class="solution">
    <h2 id="solution-to-challenge-4">Solution to Challenge 4</h2>
    <p>1). <code class="language-plaintext highlighter-rouge">hist(x = perms)</code> or <code class="language-plaintext highlighter-rouge">hist(x = perms, breaks = 15)</code>  <br />
2). By counting number of occurrences of each LOD value (frequencies), we can approximate the 95th percentile at ~7.5. <br />
3). <code class="language-plaintext highlighter-rouge">summary(perms)</code></p>
  </blockquote>
</blockquote>

<p>We can now add thresholds to the previous QTL plot. We use a significance threshold of p &lt; 0.05. To do this, we select the 95th percentile of the permutation LOD distribution.</p>

<div class="language-plaintext r highlighter-rouge"><div class="highlight"><pre class="highlight"><code>plot(x = qtl, map = map,  main = "Proportion of Micro-nucleated Bone Marrow Reticulocytes")
thr = summary(perms)
abline(h = thr, col = "red", lwd = 2)
</code></pre></div></div>

<div class="figure" style="text-align: center">
<img src="../fig/rmd-13-qtl_plot_thr-1.png" alt="plot of chunk qtl_plot_thr" />
<p class="caption">plot of chunk qtl_plot_thr</p>
</div>

<p>The peak on Chr 10 is well above the red significance line.</p>

<h3 id="finding-lod-peaks"><a href="https://smcclatchy.github.io/mapping/07-find-lod-peaks/">Finding LOD peaks</a></h3>
<p>We can then plot the QTL scan. Note that you must provide the marker map, which we loaded earlier in the MUGA SNP data.</p>

<p>We can find all of the peaks above the significance threshold using the <a href="https://github.com/rqtl/qtl2/blob/master/R/find_peaks.R">find_peaks</a> function.</p>

<div class="language-plaintext r highlighter-rouge"><div class="highlight"><pre class="highlight"><code>find_peaks(scan1_output = qtl, map = map, threshold = thr)
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  lodindex  lodcolumn chr      pos      lod
1        1 log.MN.RET  10 33.64838 26.22947
</code></pre></div></div>

<blockquote class="challenge">
  <h2 id="challenge-5-find-all-peaks">Challenge 5 Find all peaks</h2>
  <p>Find all peaks for this scan whether or not they meet the 95% significance threshold.</p>
  <blockquote class="solution">
    <h2 id="solution-to-challenge-5">Solution to Challenge 5</h2>
    <p><code class="language-plaintext highlighter-rouge">find_peaks(scan1_output = qtl, map = map)</code><br />
Notice that some peaks are missing because they don’t meet the default threshold value of 3. See <code class="language-plaintext highlighter-rouge">help(find_peaks)</code> for more information about this function.</p>
  </blockquote>
</blockquote>

<p>The support interval is determined using the <a href="http://www.ncbi.nlm.nih.gov/pubmed/11560912">Bayesian Credible Interval</a> and represents the region most likely to contain the causative polymorphism(s). We can obtain this interval by adding a <code class="language-plaintext highlighter-rouge">prob</code> argument to <a href="https://github.com/rqtl/qtl2/blob/master/R/find_peaks.R">find_peaks</a>. We pass in a value of <code class="language-plaintext highlighter-rouge">0.95</code> to request a support interval that contains the causal SNP 95% of the time.</p>

<div class="language-plaintext r highlighter-rouge"><div class="highlight"><pre class="highlight"><code>find_peaks(scan1_output = qtl, map = map, threshold = thr, prob = 0.95)
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  lodindex  lodcolumn chr      pos      lod   ci_lo    ci_hi
1        1 log.MN.RET  10 33.64838 26.22947 31.8682 34.17711
</code></pre></div></div>

<p>From the output above, you can see that the support interval is 5.5 Mb wide (30.16649 to 35.49352 Mb). The location of the maximum LOD score is at 34.17711 Mb.</p>

<h3 id="estimated-qtl-effects"><a href="https://smcclatchy.github.io/mapping/11-est-qtl-effects/">Estimated QTL effects</a></h3>

<p>We will now zoom in on Chr 10 and look at the contribution of each of the eight founder alleles to the proportion of bone marrow reticulocytes that were micro-nucleated. Remember, the mapping model above estimates the effect of each of the eight DO founders. We can plot these effects (also called ‘coefficients’) across Chr 10 using <a href="https://github.com/rqtl/qtl2/blob/master/R/scan1coef.R">scan1coef</a>.</p>

<div class="language-plaintext r highlighter-rouge"><div class="highlight"><pre class="highlight"><code>chr &lt;- 10
coef10 &lt;- scan1blup(genoprobs = probs[,chr], pheno = pheno[c100,index, drop = FALSE], kinship &lt;- K[[chr]], addcovar = addcovar)
</code></pre></div></div>

<p>This produces an object containing estimates of each of the eight DO founder allele effect. These are the <i>β<sub>j</sub></i> values in the mapping equation above.</p>

<div class="language-plaintext r highlighter-rouge"><div class="highlight"><pre class="highlight"><code>plot_coefCC(x = coef10, map = map, scan1_output = qtl, main = "Proportion of Micro-nucleated Bone Marrow Reticulocytes")
</code></pre></div></div>

<div class="figure" style="text-align: center">
<img src="../fig/rmd-13-coef_plot-1.png" alt="plot of chunk coef_plot" />
<p class="caption">plot of chunk coef_plot</p>
</div>

<p>The top panel shows the eight founder allele effects (or model coefficients) along Chr 10. The founder allele effects are centerd at zero and the units are the same as the phenotype. You can see that DO mice containing the CAST/EiJ allele near 34 Mb have lower levels of micro-nucleated reticulocytes. This means that the CAST allele is associated with less DNA damage and has a protective effect. The bottom panel shows the LOD score, with the support interval for the peak shaded blue.</p>

<h3 id="snp-association-mapping"><a href="https://smcclatchy.github.io/mapping/12-snp-assoc/">SNP Association Mapping</a></h3>

<p>At this point, we have a 6 Mb wide support interval that contains a polymorphism(s) that influences benzene-induced DNA damage. Next, we will impute the DO founder sequences onto the DO genomes. The <a href="http://www.sanger.ac.uk/resources/mouse/genomes/">Sanger Mouse Genomes Project</a> has sequenced the eight DO founders and provides SNP, insertion-deletion (indel), and structural variant files for the strains (see <a href="http://www.nature.com/ng/journal/v45/n7/full/ng.2644.html">Baud et.al., Nat. Gen., 2013</a>). We can impute these SNPs onto the DO genomes and then perform association mapping. The process involves several steps and I have provided a function to encapsulate the steps. To access the Sanger SNPs, we use a SQLlite database provided by <a href="https://github.com/kbroman">Karl Broman</a>. You should have downloaded this during <a href="../setup.md">Setup</a>. It is available from the <a href="ftp://ftp.jax.org/dgatti/CC_SNP_DB/cc_variants.sqlite">JAX FTP site</a>, but the file is 3 GB, so it may take too long to download right now.</p>

<p><img src="../fig/DO.impute.founders.sm.png" alt="" /></p>

<p>Association mapping involves imputing the founder SNPs onto each DO genome and fitting the mapping model at each SNP. At each marker, we fit the following model:</p>

<p><img src="../fig/equation2.png" alt="" /></p>

<p>where:</p>

<ul>
<li><i>y<sub>i</sub></i> is the phenotype for mouse <i>i</i>,</li>
  <li><i>&beta;<sub>s</sub></i> is the effect of study cohort,</li>
  <li><i>s<sub>i</sub></i> is the study cohort for mouse <i>i</i>,</li>
  <li><i>&beta;<sub>m</sub></i> is the effect of adding one allele at marker <i>m</i>,</li>
  <li><i>g<sub>im</sub></i> is the allele call for mouse <i>i</i> at marker <i>m</i>,</li>
  <li><i>&lambda;<sub>i</sub></i> is an adjustment for kinship-induced correlated errors for mouse &lt;/i&gt;i&lt;/i&gt;,</li>
  <li><i>&epsilon;<sub>i</sub></i> is the residual error for mouse <i>i</i>.</li>
  </ul>

<p>We can call <a href="https://github.com/rqtl/qtl2/blob/master/R/scan1snps.R">scan1snps</a> to perform association mapping in the QTL interval on Chr 10. We first create variables for the chromosome and support interval where we are mapping. We then create a function to get the SNPs from the founder SNP database The path to the SNP database (<code class="language-plaintext highlighter-rouge">snpdb_file</code> argument) points to the data directory on your computer. Note that it is important to use the <code class="language-plaintext highlighter-rouge">keep_all_snps = TRUE</code> in order to return all SNPs.</p>

<div class="language-plaintext r highlighter-rouge"><div class="highlight"><pre class="highlight"><code>chr &lt;- 10
start &lt;- 30
end &lt;- 36
query_func &lt;- create_variant_query_func("../data/cc_variants.sqlite")
assoc &lt;- scan1snps(genoprobs = probs[,chr], map = map, pheno = pheno[c100,index,drop = FALSE], kinship = K, addcovar = addcovar, query_func = query_func, chr = chr, start = start, end = end, keep_all_snps = TRUE)
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">assoc</code> object is a list containing two objects: the LOD scores for each unique SNP and a <code class="language-plaintext highlighter-rouge">snpinfo</code> object that maps the LOD scores to each SNP. To plot the association mapping, we need to provide both objects to the <a href="https://github.com/rqtl/qtl2/blob/master/R/plot_snpasso.R">plot_snpasso</a> function.</p>

<div class="language-plaintext r highlighter-rouge"><div class="highlight"><pre class="highlight"><code>plot_snpasso(scan1output = assoc$lod, snpinfo = assoc$snpinfo, main = "Proportion of Micro-nucleated Bone Marrow Reticulocytes")
</code></pre></div></div>

<div class="figure" style="text-align: center">
<img src="../fig/rmd-13-assoc_fig-1.png" alt="plot of chunk assoc_fig" />
<p class="caption">plot of chunk assoc_fig</p>
</div>

<p>This plot shows the LOD score for each SNP in the QTL interval. The SNPs occur in “shelves” because all of the SNPs in a haplotype block have the same founder strain pattern. The SNPs with the highest LOD scores are the ones for which CAST/EiJ contributes the alternate allele.</p>

<p>We can add a plot containing the genes in the QTL interval using the <code class="language-plaintext highlighter-rouge">plot_genes</code> function. We get the genes from another SQLlite database created by <a href="https://github.com/kbroman">Karl Broman</a> called <code class="language-plaintext highlighter-rouge">mouse_genes.sqlite</code>. You should have downloaded this from the <a href="ftp://ftp.jax.org/dgatti/CC_SNP_DB/mouse_genes.sqlite">JAX FTP Site</a> during <a href="../setup.md">Setup</a>.</p>

<p>First, we must query the database for the genes in the interval. The path of the first argument points to the data directory on your computer.</p>

<div class="language-plaintext r highlighter-rouge"><div class="highlight"><pre class="highlight"><code>query_genes &lt;- create_gene_query_func(dbfile = "../data/mouse_genes.sqlite", filter = "source='MGI'")
genes &lt;- query_genes(chr, start, end)
head(genes)
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  chr source       type    start     stop score strand phase
1  10    MGI       gene 29.98418 30.00438    NA      -    NA
2  10    MGI pseudogene 30.01095 30.01730    NA      +    NA
3  10    MGI pseudogene 30.08426 30.08534    NA      -    NA
4  10    MGI pseudogene 30.17972 30.18042    NA      +    NA
5  10    MGI       gene 30.19457 30.20060    NA      -    NA
6  10    MGI pseudogene 30.37292 30.37556    NA      +    NA
                   ID    Name Parent
1 MGI_C57BL6J_6097611 Gm48215   &lt;NA&gt;
2 MGI_C57BL6J_2685078   Gm232   &lt;NA&gt;
3 MGI_C57BL6J_3647013  Gm8767   &lt;NA&gt;
4 MGI_C57BL6J_3781001  Gm2829   &lt;NA&gt;
5 MGI_C57BL6J_1913561   Cenpw   &lt;NA&gt;
6 MGI_C57BL6J_3643405  Gm4780   &lt;NA&gt;
                                          Dbxref     gene_id
1                     ENSEMBL:ENSMUSG00000111195 MGI:6097611
2    NCBI_Gene:212813,ENSEMBL:ENSMUSG00000111554 MGI:2685078
3    NCBI_Gene:667696,ENSEMBL:ENSMUSG00000111001 MGI:3647013
4 NCBI_Gene:100040542,ENSEMBL:ENSMUSG00000110776 MGI:3781001
5     NCBI_Gene:66311,ENSEMBL:ENSMUSG00000075266 MGI:1913561
6    NCBI_Gene:212815,ENSEMBL:ENSMUSG00000111047 MGI:3643405
             mgi_type             description
1         lncRNA gene predicted gene%2c 48215
2          pseudogene      predicted gene 232
3          pseudogene     predicted gene 8767
4          pseudogene     predicted gene 2829
5 protein coding gene    centromere protein W
6          pseudogene     predicted gene 4780
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">genes</code> object contains annotation information for each gene in the interval.</p>

<p>Next, we will create a plot with two panels: one containing the association mapping LOD scores and one containing the genes in the QTL interval. We do this by passing in the <code class="language-plaintext highlighter-rouge">genes</code> argument to <a href="https://github.com/rqtl/qtl2/blob/master/R/plot_snpasso.R">plot_snpasso</a>. We can also adjust the proportion of the plot allocated for SNPs (on the top) and genes (on th bottom) using the ‘top_panel_prop’ argument.</p>

<div class="language-plaintext r highlighter-rouge"><div class="highlight"><pre class="highlight"><code>plot_snpasso(assoc$lod, assoc$snpinfo, main = "Proportion of Micro-nucleated Bone Marrow Reticulocytes", genes = genes, top_panel_prop = 0.5)
</code></pre></div></div>

<div class="figure" style="text-align: center">
<img src="../fig/rmd-13-plot_assoc2-1.png" alt="plot of chunk plot_assoc2" />
<p class="caption">plot of chunk plot_assoc2</p>
</div>

<h3 id="searching-for-candidate-genes">Searching for Candidate Genes</h3>

<p>One strategy for finding genes related to a phenotype is to search for genes with expression QTL (eQTL) in the same location. Ideally, we would have liver and bone marrow gene expression data in the DO mice from this experiment. Unfortunately, we did not collect this data. However, we have liver gene expression for a separate set of untreated DO mice <a href="https://churchilllab.jax.org/qtlviewer/svenson/DOHFD">Liver eQTL Viewer</a>. We searched for genes in the QTL interval that had an eQTL in the same location. Then, we looked at the pattern of founder effects to see if CAST stood out. We found two genes that met these criteria.</p>

<p><img src="../fig/French.et.al.Figure3.png" alt="" /></p>

<p>As you can see, both <i>Sult3a1</i> and <i>Gm4794</i> have eQTL in the same location on Chr 10 and mice with CAST allele (in green) express these genes more highly. <i>Sult3a1</i> is a sulfotransferase that may be involved in adding a sulphate group to phenol, one of the metabolites of benzene. Go to the Ensembl web page for <a href="http://www.ensembl.org/Mus_musculus/Gene/Summary?db=core;g=ENSMUSG00000090298;r=10:33766424-33786704">Gm4794</a>.  Note that <i>Gm4794</i> has a new name: <i>Sult3a2</i>. In the menu on the left, click on the “Gene Tree (image)” link.</p>

<p><img src="../fig/EnsEMBL_Sult3a1_Gm4794_paralog.png" alt="" /></p>

<p>As you can see, <i>Sult3a2</i> is a paralog of <i>Sult3a1</i> and hence both genes are sulfotransferases. These genes encode enzymes that attach a sulfate group to other compounds.</p>

<p>We also looked at a public gene expression database in which liver, spleen and kidney gene expression were measured in 26 inbred strains, including the eight DO founders. You can search for <i>Sult3a1</i> and <i>Gm4794</i> in this <a href="http://cgd.jax.org/gem/strainsurvey26/v1">strain survey data</a>. We did this and plotted the spleen and liver expression values. We did not have bone marrow expression data from this experiment. We also plotted the expression of all of the genes in the QTL support interval that were measured on the array (data not shown).  <i>Sult3a1</i> and its paralog <i>Gm4794</i> were the only genes with a different expression pattern in CAST. Neither gene was expressed in the spleen.</p>

<p><img src="../fig/French.et.al.Sup.Figure2.png" alt="" /></p>

<p>Next, go to the <a href="http://www.sanger.ac.uk/sanger/Mouse_SnpViewer/rel-1505">Sanger Mouse Genomes</a> website and enter <i>Sult3a1</i> into the Gene box. Scroll down and check only the DO/CC founders (129S1/SvImJ, A/J, CAST/EiJ, NOD/ShiLtJ, NZO/HlLtJ &amp; WSB/EiJ) and then scroll up and press <code class="language-plaintext highlighter-rouge">Search</code>. This will show you SNPs in <i>Sult3a1</i>. Select the <code class="language-plaintext highlighter-rouge">Structural Variants</code> tab and note the copy number gain in CAST from 33,764,194 to 33,876,194 bp. Click on the G to see the location, copy this position (10:33764194-33876194) and go to the <a href="http://useast.ensembl.org/Mus_musculus/Info/Index">Ensembl website</a>. Enter the position into the search box and press <code class="language-plaintext highlighter-rouge">Go</code>. You will see a figure similar to the one below.</p>

<p><img src="../fig/EnsEMBL.Sult3a1.png" alt="" /></p>

<p>Note that both <i>Gm4794</i> (aka <i>Sult3a2</i>) and part of <i>Sult3a1</i> are in the copy number gain region.</p>

<p>In order to visualize the size of the copy number gain, we queried the <a href="ftp://ftp-mouse.sanger.ac.uk/current_bams/">Sanger Mouse Genomes alignment files</a> for the eight founders. We piled up the reads at each base (which is beyond the scope of this tutorial) and made the figure below.</p>

<p><img src="../fig/French.et.al.Sup.Figure3.png" alt="" /></p>

<p>As you can see, there appears to be a duplicatation in the CAST founders that covers four genes: <i>Clvs2</i>, <i>Gm15939</i>, <i>Gm4794</i> and <i>Sult3a1</i>. <i>Clvs2</i> is expressed in neurons and <i>Gm15939</i> is a predicted gene that may not produce a transcript.</p>

<p>Hence, we have three pieces of evidence that narrows our candidate gene list to <i>Sult3a1</i> and <i>Gm4794</i>:</p>

<ol>
  <li>Both genes have a liver eQTL in the same location as the micronucleated reticulocytes QTL.</li>
  <li>Among genes in the micronucleated reticulocytes QTL interval, only <i>Sult3a1</i> and <i>Gm4794</i> have differential expression of the CAST allele in the liver.</li>
  <li>There is a copy number gain of these two genes in CAST.</li>
</ol>

<p>Sulfation is a prominent detoxification mechanism for benzene as well. The diagram below shows the metabolism pathway for benzene <a href="http://europepmc.org/articles/PMC4414400">(Monks, T. J., et al. (2010). Chem Biol Interact 184(1-2): 201-206.)</a> Hydroquinone, phenol and catechol are all sulfated and excreted from the body.</p>

<p><img src="../fig/Monks_ChemBiolInter_2010_Fig1.jpg" alt="" /></p>

<p>This analysis has led us to the following hypothesis. Inhaled benzene is absorbed by the lungs into the bloodstream and transported to the liver. There, it is metabolized, and some metabolites are transported to the bone marrow. One class of genes that is involved in toxicant metabolism are sulfotransferases. <a href="http://www.informatics.jax.org/marker/MGI:1931469"><i>Sult3a1</i></a> is a phase II enzyme that conjugates compounds (such as phenol, which is a metabolite of benzene) with a sulfate group before transport into the bile. It is possible that a high level of <i>Sult3a1</i> expression could remove benzene by-products and be protective. Our hypothesis is that the copy number gain in the CAST allele increases liver gene expression of <i>Sult3a1</i> and <i>Gm4794</i>. High liver expression of these genes allows mice containing the CAST allele to rapidly conjugate harmful benzene metabolites and excrete them from the body before they can reach the bone marrow and cause DNA damage. Further experimental validation is required, but this is a plausible hypothesis.</p>

<p><img src="../fig/benzene_hypothesis.png" alt="" /></p>

<p>We hope that this tutorial has shown you how the DO can be used to map QTL and use the founder effects and bioinformatics resources to narrow down the candidate gene list. Here, we made used of external gene expression databases and the founder sequence data to build a case for a pair of genes.</p>

<blockquote class="challenge">
  <h2 id="challenge-6-map-another-trait">Challenge 6 Map another trait.</h2>
  <p>1). Make a histogram of the column <code class="language-plaintext highlighter-rouge">pre.prop.MN.RET</code> in <code class="language-plaintext highlighter-rouge">pheno</code>. Does it look like it should be log transformed? If so, add a column to <code class="language-plaintext highlighter-rouge">pheno</code> that contains the log of <code class="language-plaintext highlighter-rouge">pre.prop.MN.RET</code>.<br />
2). Perform a genome scan <em>using all samples</em> on the column called <code class="language-plaintext highlighter-rouge">pre.prop.MN.RET</code>. Since you’re using all samples, the scan will take longer. (Hint: set <code class="language-plaintext highlighter-rouge">index</code> to the column index in <code class="language-plaintext highlighter-rouge">pheno</code>.)<br />
3). Which chromosome has the higest peak? Use <code class="language-plaintext highlighter-rouge">find_peaks</code> to get the location and support interval for the highest peak.<br />
4). Calculate and plot the BLUPs for the chromosome with the highest peak. (This may take a few minutes.)<br />
5). Perform association mapping in the support interval for the QTL peak, plot the results and plot the genes beneath the association mapping plot.</p>
  <blockquote class="solution">
    <h2 id="solution-to-challenge-6">Solution to Challenge 6</h2>
    <p>1). <code class="language-plaintext highlighter-rouge">hist(pheno$pre.prop.MN.RET)</code><br />
<code class="language-plaintext highlighter-rouge">pheno$log.pre.MN.RET &lt;- log(pheno$pre.prop.MN.RET)</code> <br />
2). <code class="language-plaintext highlighter-rouge">index &lt;- which(colnames(pheno) == "log.pre.MN.RET")</code><br />
<code class="language-plaintext highlighter-rouge">addcovar &lt;- model.matrix(~Study + Conc, data = pheno)[,-1]</code> <br />
<code class="language-plaintext highlighter-rouge">qtl_pre &lt;- scan1(genoprobs = probs, pheno = pheno[,index, drop = FALSE], kinship = K, addcovar = addcovar)</code> <br />
<code class="language-plaintext highlighter-rouge">plot_scan1(x = qtl_pre, map = map, main = "Log-Transformed Pre-dose micronucleated reticulocytes")</code> <br />
3). <code class="language-plaintext highlighter-rouge">find_peaks(qtl_pre, map, threshold = 10, prob = 0.95)</code> <br />
4). <code class="language-plaintext highlighter-rouge">chr &lt;- 4</code> <br />
<code class="language-plaintext highlighter-rouge">coef4 &lt;- scan1blup(genoprobs = probs[,chr], pheno = pheno[,index, drop = FALSE], kinship = K[[chr]], addcovar = addcovar)</code> <br />
<code class="language-plaintext highlighter-rouge">plot_coefCC(x = coef4, map = map, scan1_output = qtl, main = "Log-Transformed Pre-dose micronucleated reticulocytes")</code> <br />
5). <code class="language-plaintext highlighter-rouge">chr &lt;- 4</code> <br />
<code class="language-plaintext highlighter-rouge">start &lt;- 132.5</code> <br />
<code class="language-plaintext highlighter-rouge">end &lt;- 136</code> <br />
<code class="language-plaintext highlighter-rouge">assoc4 = scan1snps(genoprobs = probs[,chr], map = map, pheno = pheno[,index,drop = FALSE], kinship = K, addcovar = addcovar, query_func = query_func, chr = chr, start = start, end = end, keep_all_snps = TRUE)</code>  <br />
<code class="language-plaintext highlighter-rouge">genes &lt;- query_genes(chr, start, end)</code>  <br />
<code class="language-plaintext highlighter-rouge">plot_snpasso(assoc4$lod, assoc4$snpinfo, main = "Log-Transformed Pre-dose micronucleated reticulocytes", genes = genes)</code></p>
  </blockquote>
</blockquote>



<blockquote class="keypoints">
  <h2>Key Points</h2>
  <ul>
    
    <li><p>.</p>
</li>
    
    <li><p>.</p>
</li>
    
  </ul>
</blockquote>

</article>

<div class="row">
  <div class="col-md-1">
    <h3>
      
      <a href="../12-snp-assoc/"><span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span><span class="sr-only">previous episode</span></a>
      
    </h3>
  </div>
  <div class="col-md-10">
    
  </div>
  <div class="col-md-1">
    <h3>
      
      <a href="../"><span class="glyphicon glyphicon-menu-up" aria-hidden="true"></span><span class="sr-only">lesson home</span></a>
      
    </h3>
  </div>
</div>


      
      
<footer>
  <div class="row">
    <div class="col-md-6" align="left">
      <h4>
	Copyright &copy; 2016–2025
	
      </h4>
    </div>
    <div class="col-md-6" align="right">
      <h4>
	
	
	<a href="/edit/gh-pages/_episodes_rmd/13-qtl-in-do.Rmd">Edit on GitHub</a>
	
	
	/
	<a href="/blob/gh-pages/CONTRIBUTING.md">Contributing</a>
	/
	<a href="/">Source</a>
	/
	<a href="/blob/gh-pages/CITATION">Cite</a>
	/
	<a href="mailto:susan.mcclatchy@jax.org">Contact</a>
      </h4>
    </div>
  </div>
</footer>

      
    </div>
    
<script src="../assets/js/jquery.min.js"></script>
<script src="../assets/js/bootstrap.min.js"></script>
<script src="../assets/js/lesson.js"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-37305346-2', 'auto');
  ga('send', 'pageview');
</script>

  </body>
</html>
